/* empty css              */import{a as axios}from"./axios-3a3ab110.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import{r as ref,o as openBlock,c as createElementBlock,a as createVNode,w as withCtx,b as createBaseVNode,B as Button,H as Modal,A as List,d as createTextVNode,F as Fragment,z as renderList,J as Input,U as Upload,S as Space,x as createBlock,u as unref,K as IconDelete,I as Image,N as Avatar,D as ListItemMeta,P as Popconfirm,G as ListItem}from"./index-be962d38.js";const _hoisted_1={class:"ml-4 mt-4 mr-4"},_hoisted_2=createBaseVNode("h1",{class:"text-xl"},"直播管理",-1),_hoisted_3=createBaseVNode("p",null,"封面图上传",-1),_hoisted_4=["src"],_sfc_main={__name:"LiveManager",setup(__props){const liveList=ref([]),baseURL=window.location.href.split(":")[0]+":"+window.location.href.split(":")[1]+":8020",domain=window.location.href.split(":")[1].split("/")[2],baseImageFolder="/resource/upload/images/",addVideoDialog=ref(!1);ref(!1);const title=ref(""),headImage=ref(""),uploadVideo=ref([]),uploadImage=ref([]);getVideoList();function getVideoList(){axios.get(baseURL+"/api/liveList").then(res=>{liveList.value=eval(res.data)})}function deleteVideo(t){axios.get(baseURL+"/api/deleteLive?id="+t.Id+"&headImage="+t.HeadImage).then(a=>{getVideoList()})}function uploadImageSuccess(t){headImage.value=t.name}function cancelAddVideo(){headImage.value!==""&&axios.get(baseURL+"/api/deleteImageFile?imageName="+headImage.value),headImage.value="",title.value="",uploadVideo.value=[],uploadImage.value=[]}async function addLive(){return headImage.value===""?(alert("封面图不能为空。"),!1):title.value===""?(alert("直播标题不能为空。"),!1):(await axios.get(baseURL+"/api/addLive?title="+title.value+"&headImage="+headImage.value+"&record=false"),getVideoList(),headImage.value="",title.value="",uploadVideo.value=[],uploadImage.value=[],!0)}function onImageRemove(){axios.get(baseURL+"/api/deleteImageFile?imageName="+headImage.value)}return(t,a)=>{const o=Button,i=Input,l=Upload,s=Space,n=Modal,d=Image,r=Avatar,c=ListItemMeta,u=Popconfirm,m=ListItem,p=List;return openBlock(),createElementBlock("div",_hoisted_1,[_hoisted_2,createVNode(o,{type:"primary",onClick:a[0]||(a[0]=e=>addVideoDialog.value=!addVideoDialog.value)},{default:withCtx(()=>[createTextVNode("创建直播")]),_:1}),createVNode(n,{visible:addVideoDialog.value,"onUpdate:visible":a[3]||(a[3]=e=>addVideoDialog.value=e),onCancel:cancelAddVideo,"on-before-ok":addLive,width:"auto"},{title:withCtx(()=>[createTextVNode(" 创建直播 ")]),default:withCtx(()=>[createBaseVNode("div",null,[createVNode(s,{direction:"vertical",class:"w-full"},{default:withCtx(()=>[createVNode(i,{placeholder:"直播标题",modelValue:title.value,"onUpdate:modelValue":a[1]||(a[1]=e=>title.value=e)},null,8,["modelValue"]),_hoisted_3,createVNode(l,{"list-type":"picture-card",action:baseURL+"/api/uploadImage","image-preview":"",limit:1,accept:"image/*",onSuccess:uploadImageSuccess,"file-list":uploadImage.value,"onUpdate:fileList":a[2]||(a[2]=e=>uploadImage.value=e),onOnBeforeRemove:onImageRemove},null,8,["action","file-list"])]),_:1})])]),_:1},8,["visible"]),createVNode(p,{class:"mt-4"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(liveList.value.reverse(),e=>(openBlock(),createBlock(m,null,{actions:withCtx(()=>[createVNode(u,{content:"您确定要删除此直播吗？",type:"error",onOk:_=>deleteVideo(e)},{default:withCtx(()=>[createVNode(unref(IconDelete))]),_:2},1032,["onOk"])]),default:withCtx(()=>[createVNode(c,{title:e.Title+e.Id,description:"推流地址：rtmp://"+unref(domain)+":1936/live/  推流码："+e.Id},{avatar:withCtx(()=>[createVNode(r,{shape:"square"},{default:withCtx(()=>[createBaseVNode("img",{alt:"avatar",src:baseURL+baseImageFolder+e.HeadImage},null,8,_hoisted_4)]),_:2},1024)]),default:withCtx(()=>[createVNode(d,{slot:"avatar",src:baseURL+baseImageFolder+e.HeadImage,fit:"contain","preview-visible":!1,style:{cursor:"pointer"}},null,8,["src"])]),_:2},1032,["title","description"])]),_:2},1024))),256))]),_:1})])}}};export{_sfc_main as default};
