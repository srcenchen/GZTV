import{R as i,r as g,j as s}from"./index-229d3f21.js";import{a as r}from"./axios-345d0e8d.js";import{T as A,a as Z,b as u,c as q,d as G,e as d,D as f,f as o,g as x,h,i as j,j as N,k as S,S as J,U as v,l as Q}from"./upload-ec2c9665.js";import{M as n,B as c}from"./index-0ef969c2.js";import{T as W}from"./Textarea-fd173e33.js";import{T as X}from"./Title2-3e5572f9.js";import{I as Y}from"./Input-b05c6c7c.js";import"./resolveShorthand-c493b016.js";import"./getSlots-13b5e575.js";import"./useFocusWithin-addd22dc.js";import"./useTabsterAttributes-056b7130.js";import"./useEventCallback-8508b99a.js";import"./createFluentIcon-18be32a3.js";import"./__resetStyles.esm-2c4b7293.js";import"./useFieldControlProps-2de15a5e.js";import"./createPreset-900bce2b.js";import"./useTextStyles-4214d636.js";function Se(){const[e,a]=i.useState([]),t=i.useRef(null),b=i.useRef(null),[D,T]=i.useState(""),[V,I]=i.useState(""),[y,R]=i.useState(""),[C,U]=i.useState(""),[E,B]=i.useState(!1),[w,K]=i.useState(!1),[O,k]=i.useState(!1),[P,M]=i.useState(!1),[z,F]=i.useState(0);g.useEffect(()=>{m(a)},[]);const H=[{columnKey:"Title",label:"标题"},{columnKey:"Description",label:"介绍"},{columnKey:"UploadDate",label:"时间"},{columnKey:"action",label:"操作"}];return s.jsxs("div",{className:"flex flex-col justify-center ",children:[s.jsx(X,{className:"mb-2 ml-2",children:"视频管理"}),s.jsx(_,{videoRef:t,imageRef:b,videoName:D,imageName:V,title:y,description:C,uploading:E,open:w,setOpen:K,setVideoName:T,setImageName:I,setTitle:R,setDescription:U,setUploading:B,setProgress:F,setData:a,setVideoSelected:k,setImageSelected:M,progress:z,imageSelected:P,videoSelected:O}),s.jsx("div",{className:"ml-4 mt-2",children:s.jsxs(A,{children:[s.jsx(Z,{children:s.jsx(u,{children:H.map(l=>s.jsx(q,{children:l.label},l.columnKey))})}),s.jsx(G,{children:e.map((l,L)=>s.jsxs(u,{children:[s.jsx(d,{children:l.Title}),s.jsx(d,{children:l.Description}),s.jsx(d,{children:l.UploadDate}),s.jsx(d,{role:"gridcell",children:ee({item:l,setData:a})})]},L))})]})})]})}function _(e){const a=()=>{if(e.title===""){n.error("请输入视频标题");return}if(e.description===""){n.error("请输入视频简介");return}if(!e.videoSelected){n.error("请选择视频");return}if(!e.imageSelected){n.error("请选择封面");return}e.setUploading(!0),e.videoRef.current.submit(),e.imageRef.current.submit()};return g.useEffect(()=>{e.videoName&&e.imageName&&e.uploading&&r.post("/api/addVideo",{title:e.title,description:e.description,video:e.videoName,cover:e.imageName}).then(t=>{t.data.message==="success"?(n.success("发布成功"),e.setVideoName(""),e.setImageName(""),e.setTitle(""),e.setDescription(""),e.setImageSelected(!1),e.setVideoSelected(!1),e.setOpen(!1),e.setUploading(!1),m(e.setData)):(n.error("发布失败"),e.setUploading(!1))})},[e.videoName,e.imageName]),s.jsxs(f,{open:e.open,onOpenChange:()=>{e.setOpen(!0)},children:[s.jsx(o,{disableButtonEnhancement:!0,children:s.jsx(c,{appearance:"primary",className:"w-0",style:{marginTop:"6px",marginLeft:"8px"},children:"发布视频"})}),s.jsx(x,{children:s.jsxs(h,{children:[s.jsx(j,{action:null,children:"发布视频"}),s.jsx(N,{children:s.jsxs("div",{className:"flex flex-col",children:[s.jsx(Y,{placeholder:"请输入视频标题",value:e.title,onChange:t=>{e.setTitle(t.target.value)}}),s.jsx("div",{className:"mt-2"}),s.jsx(W,{placeholder:"请输入视频简介",value:e.description,onChange:t=>{e.setDescription(t.target.value)}}),s.jsxs("div",{className:"mt-2",children:[s.jsx($,{videoRef:e.videoRef,setVideoName:e.setVideoName,setVideoSelected:e.setVideoSelected,setProgress:e.setProgress}),s.jsx(p,{imageRef:e.imageRef,setImageName:e.setImageName,setImageSelected:e.setImageSelected})]})]})}),s.jsxs(S,{children:[s.jsx(c,{appearance:"secondary",onClick:()=>{e.setOpen(!1),e.setVideoName(""),e.setImageName(""),e.setTitle(""),e.setDescription(""),e.setImageSelected(!1),e.setVideoSelected(!1)},disabled:e.uploading,children:"取消"}),s.jsx(c,{appearance:"primary",onClick:a,disabled:e.uploading,children:e.uploading?s.jsx(J,{size:"small"}):"上传并发布"})]})]})})]})}function $(e){return s.jsxs("div",{className:"flex flex-col",style:{overflow:"hidden"},children:[s.jsx("label",{className:"mb-1",children:"上传视频"}),s.jsx(v,{action:"/api/uploadVideo",ref:e.videoRef,showUploadList:{startIcon:s.jsx(s.Fragment,{}),cancelIcon:s.jsx(s.Fragment,{})},progressProps:{size:"small",showText:!0},drag:!0,limit:1,autoUpload:!1,accept:"video/*",onChange:a=>{try{a[0].status==="done"&&e.setVideoName(a[0].response.file)}catch{}e.setVideoSelected(!0)}})]})}function p(e){return s.jsxs("div",{className:"flex flex-col mt-2",children:[s.jsx("label",{className:"mb-1",children:"上传封面"}),s.jsx(v,{className:"w-18",action:"/api/uploadImage",ref:e.imageRef,listType:"picture-card",limit:1,autoUpload:!1,accept:"image/*",onChange:a=>{try{a[0].status==="done"&&e.setImageName(a[0].response.fileName)}catch{}e.setImageSelected(!0)}})]})}function ee(e){return s.jsxs(f,{children:[s.jsx(o,{disableButtonEnhancement:!0,children:s.jsx(c,{icon:s.jsx(Q,{})})}),s.jsx(x,{children:s.jsxs(h,{children:[s.jsx(j,{children:"删除警告"}),s.jsxs(N,{children:['将要删除标题为 "',e.item.Title,'" 的视频',s.jsx("br",{}),"此操作不可逆，确认删除？"]}),s.jsxs(S,{children:[s.jsx(o,{disableButtonEnhancement:!0,children:s.jsx(c,{appearance:"secondary",children:"取消"})}),s.jsx(o,{children:s.jsx(c,{appearance:"primary",onClick:()=>{se(e.item.Id,e.setData)},children:"确认"})})]})]})})]})}function m(e){r.get("/api/getVideos").then(a=>{a.data.forEach(t=>{t.UploadDate=t.UploadDate.replace("T"," ").replace("Z"," ")}),a.data.reverse(),e(a.data)})}function se(e,a){r.get("/api/deleteVideo?id="+e).then(t=>{console.log(t),m(a)})}export{Se as default};
