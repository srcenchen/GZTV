import{R as l,r as V,j as e}from"./index-09ec4dc2.js";import{a as v}from"./axios-345d0e8d.js";import{T as Z,a as q,b as U,c as G,d as J,e as p,D as E,f as u,g as Q,h as I,i as P,j as K,k,l as O,S as W,U as B}from"./index-9989fca2.js";import{M as n}from"./index-5cb1c7f4.js";import{T as X,P as Y}from"./ProgressBar-475be2e9.js";import{T as _}from"./Title2-3663bd5b.js";import{B as c}from"./useGlobalIcon-812a6be2.js";import{I as $}from"./Input-09800caa.js";import"./resolveShorthand-99dfbda9.js";import"./getSlots-e488a03d.js";import"./useFocusWithin-4ded13d4.js";import"./useTabsterAttributes-741a7341.js";import"./useEventCallback-c85cc370.js";import"./createFluentIcon-c9be95c4.js";import"./parseTNode-3dbd7448.js";import"./createPreset-a476b1f6.js";import"./useTextStyles-e4faefc4.js";import"./__resetStyles.esm-728630fa.js";function Te(){const[i,t]=l.useState([]);function r(){const s=l.useRef(null),d=l.useRef(null),[f,D]=l.useState(""),[x,S]=l.useState(""),[h,N]=l.useState(""),[j,y]=l.useState(""),[m,g]=l.useState(!1),[M,b]=l.useState(!1);let C=!1,R=!1;const[F,H]=l.useState(0),z=()=>{if(h===""){n.error("请输入视频标题");return}if(j===""){n.error("请输入视频简介");return}if(!C){n.error("请选择视频");return}if(!R){n.error("请选择封面");return}g(!0);const a=s,o=d;a.current.uploadFiles(),o.current.uploadFiles()};V.useEffect(()=>{f&&x&&m&&v.post("/api/addVideo",{title:h,description:j,video:f,cover:x}).then(a=>{a.data.message==="success"?(n.success("发布成功"),b(!1),g(!1),T(t)):(n.error("发布失败"),g(!1))})},[f,x]);function A(a){return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-1",children:"上传视频"}),e.jsx(B,{action:"/api/uploadVideo",autoUpload:!1,max:0,method:"POST",multiple:!1,name:"file",accept:"video/*",ref:a.videoRef,onSuccess:o=>{console.log(o.file.response.file),D(o.file.response.file)},onSelectChange:()=>{C=!0},onProgress:o=>{H(o.percent)}})]})}function L(a){return e.jsxs("div",{className:"flex flex-col ml-8",children:[e.jsx("label",{className:"mb-1",children:"上传封面"}),e.jsx(B,{action:"/api/uploadImage",autoUpload:!1,max:0,method:"POST",multiple:!1,name:"file",accept:"image/*",ref:a.imageRef,onSuccess:o=>{console.log(o.file.response.fileName),S(o.file.response.fileName)},onSelectChange:()=>{R=!0}})]})}return e.jsxs(E,{open:M,onOpenChange:()=>{b(!0)},modalType:"non-modal",children:[e.jsx(u,{disableButtonEnhancement:!0,children:e.jsx(c,{appearance:"primary",className:"w-0",style:{marginTop:"6px",marginLeft:"8px"},children:"发布视频"})}),e.jsx(I,{children:e.jsxs(P,{children:[e.jsx(K,{action:null,children:"发布视频"}),e.jsx(k,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx($,{placeholder:"请输入视频标题",value:h,onChange:a=>{N(a.target.value)}}),e.jsx("div",{className:"mt-2"}),e.jsx(X,{placeholder:"请输入视频简介",value:j,onChange:a=>{y(a.target.value)}}),e.jsxs("div",{className:"mt-2 flex flex-row justify-center",children:[e.jsx(A,{videoRef:s}),e.jsx(L,{imageRef:d})]}),e.jsx("br",{}),e.jsx(Y,{value:F,max:100})]})}),e.jsxs(O,{children:[e.jsx(c,{appearance:"secondary",onClick:()=>{b(!1),D(""),S(""),N(""),y("")},disabled:m,children:"取消"}),e.jsx(c,{appearance:"primary",onClick:z,disabled:m,children:m?e.jsx(W,{size:"small"}):"上传并发布"})]})]})})]})}V.useEffect(()=>{T(t)},[]);const w=[{columnKey:"Title",label:"标题"},{columnKey:"Description",label:"介绍"},{columnKey:"UploadDate",label:"时间"},{columnKey:"action",label:"操作"}];return e.jsxs("div",{className:"flex flex-col justify-center ",children:[e.jsx(_,{className:"mb-2 ml-2",children:"视频管理"}),e.jsx(r,{}),e.jsx("div",{className:"ml-4 mt-2",children:e.jsxs(Z,{children:[e.jsx(q,{children:e.jsx(U,{children:w.map(s=>e.jsx(G,{children:s.label},s.columnKey))})}),e.jsx(J,{children:i.map((s,d)=>e.jsxs(U,{children:[e.jsx(p,{children:s.Title}),e.jsx(p,{children:s.Description}),e.jsx(p,{children:s.UploadDate}),e.jsx(p,{role:"gridcell",children:ee({item:s,setData:t})})]},d))})]})})]})}function ee(i){return e.jsxs(E,{children:[e.jsx(u,{disableButtonEnhancement:!0,children:e.jsx(c,{icon:e.jsx(Q,{})})}),e.jsx(I,{children:e.jsxs(P,{children:[e.jsx(K,{children:"删除警告"}),e.jsxs(k,{children:['将要删除标题为 "',i.item.Title,'" 的视频',e.jsx("br",{}),"此操作不可逆，确认删除？"]}),e.jsxs(O,{children:[e.jsx(u,{disableButtonEnhancement:!0,children:e.jsx(c,{appearance:"secondary",children:"取消"})}),e.jsx(u,{children:e.jsx(c,{appearance:"primary",onClick:()=>{ae(i.item.Id,i.setData)},children:"确认"})})]})]})})]})}function T(i){v.get("/api/getVideos").then(t=>{t.data.forEach(r=>{r.UploadDate=r.UploadDate.replace("T"," ").replace("Z"," ")}),t.data.reverse(),i(t.data)})}function ae(i,t){v.get("/api/deleteVideo?id="+i).then(r=>{console.log(r),T(t)})}export{Te as default};
