import{R as t,r as V,j as e}from"./index-184e6fdf.js";import{a as v}from"./axios-345d0e8d.js";import{T as A,a as L,b as U,c as Z,d as q,e as p,D as B,f,g as G,h as I,i as K,j as k,k as O,l as w,S as J,U as E}from"./index-1cbbd7f5.js";import{M as r}from"./index-c44e1336.js";import{T as Q}from"./Textarea-34e188b0.js";import{T as W}from"./Title2-41ad0ebb.js";import{B as c}from"./useGlobalIcon-6f4b87c8.js";import{I as X}from"./Input-5befa27c.js";import"./resolveShorthand-d409517b.js";import"./getSlots-504e8e8d.js";import"./useFocusWithin-4f462636.js";import"./useTabsterAttributes-2cad5257.js";import"./useEventCallback-c6d905c8.js";import"./createFluentIcon-6c3b03c5.js";import"./parseTNode-9250159c.js";import"./createPreset-8bea6d0c.js";import"./useTextStyles-3e4a8e13.js";import"./__resetStyles.esm-715586b5.js";function je(){const[l,i]=t.useState([]);function n(){const s=t.useRef(null),d=t.useRef(null),[u,D]=t.useState(""),[x,S]=t.useState(""),[h,N]=t.useState(""),[j,y]=t.useState(""),[m,g]=t.useState(!1),[P,b]=t.useState(!1);let C=!1,R=!1;const F=()=>{if(h===""){r.error("请输入视频标题");return}if(j===""){r.error("请输入视频简介");return}if(!C){r.error("请选择视频");return}if(!R){r.error("请选择封面");return}g(!0);const a=s,o=d;a.current.uploadFiles(),o.current.uploadFiles()};V.useEffect(()=>{u&&x&&m&&v.post("/api/addVideo",{title:h,description:j,video:u,cover:x}).then(a=>{a.data.message==="success"?(r.success("发布成功"),b(!1),g(!1),T(i)):(r.error("发布失败"),g(!1))})},[u,x]);function H(a){return e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"mb-1",children:"上传视频"}),e.jsx(E,{action:"/api/uploadVideo",autoUpload:!1,max:0,method:"POST",multiple:!1,name:"file",accept:"video/*",ref:a.videoRef,onSuccess:o=>{console.log(o.file.response.file),D(o.file.response.file)},onSelectChange:()=>{C=!0}})]})}function z(a){return e.jsxs("div",{className:"flex flex-col ml-8",children:[e.jsx("label",{className:"mb-1",children:"上传封面"}),e.jsx(E,{action:"/api/uploadImage",autoUpload:!1,max:0,method:"POST",multiple:!1,name:"file",accept:"image/*",ref:a.imageRef,onSuccess:o=>{console.log(o.file.response.fileName),S(o.file.response.fileName)},onSelectChange:()=>{R=!0}})]})}return e.jsxs(B,{open:P,onOpenChange:()=>{b(!0)},modalType:"non-modal",children:[e.jsx(f,{disableButtonEnhancement:!0,children:e.jsx(c,{appearance:"primary",className:"w-0",style:{marginTop:"6px",marginLeft:"8px"},children:"发布视频"})}),e.jsx(I,{children:e.jsxs(K,{children:[e.jsx(k,{action:null,children:"发布视频"}),e.jsx(O,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(X,{placeholder:"请输入视频标题",value:h,onChange:a=>{N(a.target.value)}}),e.jsx("div",{className:"mt-2"}),e.jsx(Q,{placeholder:"请输入视频简介",value:j,onChange:a=>{y(a.target.value)}}),e.jsxs("div",{className:"mt-2 flex flex-row justify-center",children:[e.jsx(H,{videoRef:s}),e.jsx(z,{imageRef:d})]})]})}),e.jsxs(w,{children:[e.jsx(c,{appearance:"secondary",onClick:()=>{b(!1),D(""),S(""),N(""),y("")},disabled:m,children:"取消"}),e.jsx(c,{appearance:"primary",onClick:F,disabled:m,children:m?e.jsx(J,{size:"small"}):"上传并发布"})]})]})})]})}V.useEffect(()=>{T(i)},[]);const M=[{columnKey:"Title",label:"标题"},{columnKey:"Description",label:"介绍"},{columnKey:"UploadDate",label:"时间"},{columnKey:"action",label:"操作"}];return e.jsxs("div",{className:"flex flex-col justify-center ",children:[e.jsx(W,{className:"mb-2 ml-2",children:"视频管理"}),e.jsx(n,{}),e.jsx("div",{className:"ml-4 mt-2",children:e.jsxs(A,{children:[e.jsx(L,{children:e.jsx(U,{children:M.map(s=>e.jsx(Z,{children:s.label},s.columnKey))})}),e.jsx(q,{children:l.map((s,d)=>e.jsxs(U,{children:[e.jsx(p,{children:s.Title}),e.jsx(p,{children:s.Description}),e.jsx(p,{children:s.UploadDate}),e.jsx(p,{role:"gridcell",children:Y({item:s,setData:i})})]},d))})]})})]})}function Y(l){return e.jsxs(B,{children:[e.jsx(f,{disableButtonEnhancement:!0,children:e.jsx(c,{icon:e.jsx(G,{})})}),e.jsx(I,{children:e.jsxs(K,{children:[e.jsx(k,{children:"删除警告"}),e.jsxs(O,{children:['将要删除标题为 "',l.item.Title,'" 的视频',e.jsx("br",{}),"此操作不可逆，确认删除？"]}),e.jsxs(w,{children:[e.jsx(f,{disableButtonEnhancement:!0,children:e.jsx(c,{appearance:"secondary",children:"取消"})}),e.jsx(f,{children:e.jsx(c,{appearance:"primary",onClick:()=>{_(l.item.Id,l.setData)},children:"确认"})})]})]})})]})}function T(l){v.get("/api/getVideos").then(i=>{i.data.forEach(n=>{n.UploadDate=n.UploadDate.replace("T"," ").replace("Z"," ")}),i.data.reverse(),l(i.data)})}function _(l,i){v.get("/api/deleteVideo?id="+l).then(n=>{console.log(n),T(i)})}export{je as default};
