import{a as V}from"./axios-aba6f0e0.js";import{u as P,a as Z,_ as q,b as G,c as Q}from"./Upload-cc9791c8.js";import{y as W,b as $,c as I,f as u,r as a,o as X,d as o,w as n,k as h,h as Y,a1 as ee,e as i,_ as k,K as oe}from"./index-51b823b5.js";import{N as te}from"./headers-94c1b548.js";import{_ as ne}from"./Input-1c07be01.js";import{N as ae}from"./Dropdown-b213b067.js";import{_ as le}from"./text-1ad9e4f8.js";import{_ as se}from"./Space-fa378203.js";import"./Image-1d56cfa5.js";import"./use-locale-e5897699.js";import"./use-compitable-96053cce.js";import"./Empty-801f29aa.js";const ie={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},ue=u("path",{d:"M80 152v256a40.12 40.12 0 0 0 40 40h272a40.12 40.12 0 0 0 40-40V152",fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32"},null,-1),re=u("rect",{x:"48",y:"64",width:"416",height:"80",rx:"28",ry:"28",fill:"none",stroke:"currentColor","stroke-linejoin":"round","stroke-width":"32"},null,-1),de=u("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M320 304l-64 64l-64-64"},null,-1),ce=u("path",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"32",d:"M256 345.89V224"},null,-1),pe=[ue,re,de,ce],_e=W({name:"ArchiveOutline",render:function(x,_){return $(),I("svg",ie,pe)}}),fe={class:"p-8"},ve={style:{"margin-bottom":"12px"}},me={class:"flex justify-end"},Le={__name:"VideoManage",setup(M){const x=P(),_=Z(),r=a(!1),l=a(!1),f=a(""),v=a(""),b=a(null),N=a(null),w=a(0),y=a(0),j=[{title:"视频标题",dataIndex:"Title",key:"Title"},{title:"视频介绍",dataIndex:"Description",key:"Description",slots:{customRender:"Description"}},{title:"上传时间",dataIndex:"UploadDate",key:"UploadDate",slots:{customRender:"UploadDate"}},{title:"操作",key:"action",render(t){return Y(k,{type:"error",onClick:()=>{const e=x.warning({title:"警告",content:"确定要删除该视频吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{e.loading=!0,V.get(m+"/api/deleteVideo?id="+t.Id).then(p=>{e.loading=!1,p.data.message==="success"?C():x.error({title:"错误",content:"删除失败"})})}})}},{default:()=>"删除"})}}],m="//"+window.location.hostname+":8020",g=a([]);X(()=>{C()});function C(){V.get(m+"/api/getVideos").then(t=>{const e=t.data;e.forEach(p=>{p.UploadDate=p.UploadDate.replace("T"," ").replace("Z","")}),g.value=e,g.value=g.value.reverse()})}function F(){var t,e;if(l.value=!0,f.value===""||v.value===""){_.error("标题和介绍不能为空"),l.value=!1;return}if(w.value===0||y.value===0){_.error("视频和封面不能为空"),l.value=!1;return}(t=b.value)==null||t.submit(),(e=N.value)==null||e.submit()}function B(t){w.value=t.fileList.length}function z(t){y.value=t.fileList.length}const d=a(""),c=a("");function H(t){d.value=t.event.currentTarget.response,d.value=JSON.parse(d.value).file,R()}function O(t){c.value=t.event.currentTarget.response,c.value=JSON.parse(c.value).fileName,R()}function R(){d.value!==""&&c.value!==""&&V.post(m+"/api/addVideo",{title:f.value,description:v.value,video:d.value,cover:c.value}).then(t=>{t.data.message==="success"?(r.value=!1,_.success("发布成功"),C(),r.value=!1,l.value=!1,f.value="",v.value="",d.value="",c.value="",w.value=0,y.value=0):(_.error("发布失败"),l.value=!1)})}return(t,e)=>{const p=te,U=ne,A=ae,D=le,E=G,L=Q,T=se,J=oe,S=ee,K=q;return $(),I("div",fe,[o(p,null,{default:n(()=>[i("视频管理")]),_:1}),o(h(k),{type:"primary",onClick:e[0]||(e[0]=s=>r.value=!0)},{default:n(()=>[i("发布视频")]),_:1}),o(S,{show:r.value,"onUpdate:show":e[4]||(e[4]=s=>r.value=s),"mask-closable":!1},{default:n(()=>[o(J,{style:{width:"480px"},title:"发布视频",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:n(()=>[u("div",me,[o(T,null,{default:n(()=>[o(h(k),{type:"info",onClick:e[3]||(e[3]=s=>r.value=!1),disabled:l.value},{default:n(()=>[i("取消")]),_:1},8,["disabled"]),o(h(k),{type:"primary",loading:l.value,onClick:F},{default:n(()=>[i("上传并发布")]),_:1},8,["loading"])]),_:1})])]),default:n(()=>[u("div",null,[o(T,{vertical:""},{default:n(()=>[o(U,{value:f.value,"onUpdate:value":e[1]||(e[1]=s=>f.value=s),placeholder:"请输入视频标题","show-count":"",maxlength:20},null,8,["value"]),o(U,{value:v.value,"onUpdate:value":e[2]||(e[2]=s=>v.value=s),placeholder:"请输入视频介绍","show-count":"",maxlength:30},null,8,["value"]),o(L,{multiple:"","directory-dnd":"",action:m+"/api/uploadVideo",max:1,"default-upload":!1,accept:"video/*",ref_key:"uploadRefVideo",ref:b,onChange:B,onFinish:H},{default:n(()=>[o(E,null,{default:n(()=>[u("div",ve,[o(A,{size:"48",depth:3},{default:n(()=>[o(h(_e))]),_:1})]),o(D,{style:{"font-size":"16px"}},{default:n(()=>[i(" 点击或者拖动视频到该区域来上传 ")]),_:1})]),_:1})]),_:1},8,["action"]),o(D,null,{default:n(()=>[i("封面图")]),_:1}),o(L,{action:m+"/api/uploadImage","list-type":"image-card",max:1,"default-upload":!1,accept:"image/*",ref_key:"uploadRefCover",ref:N,onChange:z,onFinish:O},{default:n(()=>[i(" 点击上传 ")]),_:1},8,["action"])]),_:1})])]),_:1})]),_:1},8,["show"]),o(K,{columns:j,data:g.value,bordered:!1,class:"mt-4"},null,8,["data"])])}}};export{Le as default};
