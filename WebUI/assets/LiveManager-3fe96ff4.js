import{R as n,r as R,j as e}from"./index-09ec4dc2.js";import{a as v}from"./axios-345d0e8d.js";import{c as k}from"./createFluentIcon-c9be95c4.js";import{M as d}from"./index-5cb1c7f4.js";import{T as z,a as H,b as E,c as O,d as V,e as m,D as b,f as c,g as q,h as C,i as D,j as N,k as y,l as T,S as G,U as J}from"./index-9989fca2.js";import{T as Q}from"./Title2-3663bd5b.js";import{B as Z}from"./Badge-8b68964b.js";import{B as l}from"./useGlobalIcon-812a6be2.js";import{I as W}from"./Input-09800caa.js";import{T as X,P as Y}from"./ProgressBar-475be2e9.js";import"./getSlots-e488a03d.js";import"./resolveShorthand-99dfbda9.js";import"./useFocusWithin-4ded13d4.js";import"./useTabsterAttributes-741a7341.js";import"./useEventCallback-c85cc370.js";import"./parseTNode-3dbd7448.js";import"./createPreset-a476b1f6.js";import"./useTextStyles-e4faefc4.js";import"./__resetStyles.esm-728630fa.js";const _=k("AppsListDetail24Filled","24",["M4.25 4C3.01 4 2 5 2 6.25v2.5C2 9.99 3 11 4.25 11h2.5C7.99 11 9 10 9 8.75v-2.5C9 5.01 8 4 6.75 4h-2.5Zm7 1a.75.75 0 0 0 0 1.5h10a.75.75 0 0 0 0-1.5h-10Zm0 3a.75.75 0 0 0 0 1.5h7a.75.75 0 0 0 0-1.5h-7Zm-7 5C3.01 13 2 14 2 15.25v2.5C2 18.99 3 20 4.25 20h2.5C7.99 20 9 19 9 17.75v-2.5C9 14.01 8 13 6.75 13h-2.5Zm7 1a.75.75 0 0 0 0 1.5h10a.75.75 0 0 0 0-1.5h-10Zm0 3a.75.75 0 0 0 0 1.5h7a.75.75 0 0 0 0-1.5h-7Z"]),I=k("Copy24Regular","24",["M5.5 4.63V17.25c0 1.8 1.46 3.25 3.25 3.25h8.62c-.31.88-1.15 1.5-2.13 1.5H8.75A4.75 4.75 0 0 1 4 17.25V6.75c0-.98.63-1.81 1.5-2.12ZM17.75 2C18.99 2 20 3 20 4.25v13c0 1.24-1 2.25-2.25 2.25h-9c-1.24 0-2.25-1-2.25-2.25v-13C6.5 3.01 7.5 2 8.75 2h9Zm0 1.5h-9a.75.75 0 0 0-.75.75v13c0 .41.34.75.75.75h9c.41 0 .75-.34.75-.75v-13a.75.75 0 0 0-.75-.75Z"]);function Ce(){const[a,r]=n.useState([]);function t(){const s=n.useRef(null),[o,S]=n.useState(""),[p,w]=n.useState(""),[j,B]=n.useState(""),[x,u]=n.useState(!1),[M,f]=n.useState(!1);let L=!1;const[P,U]=n.useState(0),A=()=>{if(p===""){d.error("请输入直播标题");return}if(j===""){d.error("请输入直播简介");return}if(!L){d.error("请选择封面");return}u(!0),s.current.uploadFiles()};R.useEffect(()=>{o&&x&&v.post("/api/addLive",{title:p,description:j,cover:o}).then(i=>{i.data.message==="success"?(d.success("发布成功"),f(!1),u(!1),g(r)):(d.error("发布失败"),u(!1))})},[o]);function F(i){return e.jsxs("div",{className:"flex flex-col ml-8",children:[e.jsx("label",{className:"mb-1",children:"上传封面"}),e.jsx(J,{action:"/api/uploadImage",autoUpload:!1,max:0,method:"POST",multiple:!1,name:"file",accept:"image/*",ref:i.imageRef,onSuccess:h=>{console.log(h.file.response.fileName),S(h.file.response.fileName)},onSelectChange:()=>{L=!0},onProgress:h=>{U(h.percent)}})]})}return e.jsxs(b,{open:M,onOpenChange:()=>{f(!0)},modalType:"non-modal",children:[e.jsx(c,{disableButtonEnhancement:!0,children:e.jsx(l,{appearance:"primary",className:"w-0",style:{marginTop:"6px",marginLeft:"8px"},children:"发起直播"})}),e.jsx(C,{children:e.jsxs(D,{children:[e.jsx(N,{action:null,children:"发布直播"}),e.jsx(y,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(W,{placeholder:"请输入直播标题",value:p,onChange:i=>{w(i.target.value)}}),e.jsx("div",{className:"mt-2"}),e.jsx(X,{placeholder:"请输入直播简介",value:j,onChange:i=>{B(i.target.value)}}),e.jsx("div",{className:"mt-2 flex flex-row justify-center",children:e.jsx(F,{imageRef:s})}),e.jsx("br",{}),e.jsx(Y,{value:P,max:100})]})}),e.jsxs(T,{children:[e.jsx(l,{appearance:"secondary",onClick:()=>{f(!1),S(""),w(""),B("")},disabled:x,children:"取消"}),e.jsx(l,{appearance:"primary",onClick:A,disabled:x,children:x?e.jsx(G,{size:"small"}):"上传并发起"})]})]})})]})}R.useEffect(()=>{g(r)},[]);const K=[{columnKey:"Title",label:"标题"},{columnKey:"Description",label:"简介"},{columnKey:"state",label:"状态"},{columnKey:"date",label:"时间"},{columnKey:"action",label:"操作"}];return e.jsxs("div",{className:"flex flex-col justify-center ",children:[e.jsx(Q,{className:"mb-2 ml-2",children:"直播管理"}),e.jsx(t,{}),e.jsx("div",{className:"ml-4 mt-2",children:e.jsxs(z,{children:[e.jsx(H,{children:e.jsx(E,{children:K.map(s=>e.jsx(O,{children:s.label},s.columnKey))})}),e.jsx(V,{children:a.map((s,o)=>e.jsxs(E,{children:[e.jsx(m,{children:s.Title}),e.jsx(m,{children:s.Description}),e.jsx(m,{children:s.LiveState==="true"?e.jsx(Z,{appearance:"filled",color:"success",children:"直播中"}):e.jsx(Z,{appearance:"filled",color:"danger",children:"无信号"})}),e.jsx(m,{children:s.SubmitDate}),e.jsx(m,{role:"gridcell",children:e.jsxs("div",{className:"flex flex-row",children:[e.jsx(ee,{item:s}),e.jsx("div",{className:"ml-2"}),e.jsx($,{item:s,setData:r})]})})]},o))})]})})]})}function $(a){return e.jsxs(b,{children:[e.jsx(c,{disableButtonEnhancement:!0,children:e.jsx(l,{icon:e.jsx(q,{})})}),e.jsx(C,{children:e.jsxs(D,{children:[e.jsx(N,{children:"删除警告"}),e.jsxs(y,{children:['将要删除标题为 "',a.item.Title,'" 的直播',e.jsx("br",{}),"此操作不可逆，确认删除？"]}),e.jsxs(T,{children:[e.jsx(c,{disableButtonEnhancement:!0,children:e.jsx(l,{appearance:"secondary",children:"取消"})}),e.jsx(c,{children:e.jsx(l,{appearance:"primary",onClick:()=>{ae(a.item.Id,a.setData)},children:"确认"})})]})]})})]})}function ee(a){return e.jsxs(b,{children:[e.jsx(c,{disableButtonEnhancement:!0,children:e.jsx(l,{appearance:"primary",icon:e.jsx(_,{})})}),e.jsx(C,{children:e.jsxs(D,{children:[e.jsx(N,{children:"直播详情"}),e.jsx(y,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-row items-center mt-2",children:[e.jsx("div",{className:"w-1/4",children:"推流地址："}),e.jsx("div",{className:"w-3/4",children:"rtmp://"+window.location.hostname+":1936/gztv/"}),e.jsx(l,{appearance:"primary",icon:e.jsx(I,{}),onClick:()=>{navigator.clipboard.writeText("rtmp://"+window.location.hostname+":1936/gztv/")}})]}),e.jsxs("div",{className:"flex flex-row items-center mt-2",children:[e.jsx("div",{className:"w-1/4",children:"推流码："}),e.jsx("div",{className:"w-3/4",children:a.item.StreamName}),e.jsx(l,{appearance:"primary",icon:e.jsx(I,{}),onClick:()=>{navigator.clipboard.writeText(a.item.StreamName)}})]})]})}),e.jsx(T,{children:e.jsx(c,{disableButtonEnhancement:!0,children:e.jsx(l,{appearance:"primary",children:"关闭"})})})]})})]})}function g(a){v.get("/api/getLives").then(r=>{r.data.forEach(t=>{t.SubmitDate=t.SubmitDate.replace("T"," ").replace("Z"," ")}),r.data.reverse(),a(r.data)})}function ae(a,r){v.get("/api/deleteLive?id="+a).then(t=>{console.log(t),g(r)})}export{Ce as default};
