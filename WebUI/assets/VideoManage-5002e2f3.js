import{R as i,r as g,j as s}from"./index-d28a4ff4.js";import{a as r}from"./axios-345d0e8d.js";import{T as Z,a as q,b as u,c as F,d as G,e as d,D as f,f as o,g as x,h,i as j,j as N,k as S,S as J,U as v,l as Q}from"./upload-fde8694d.js";import{M as n,B as c}from"./index-3cf3a9ca.js";import{T as W}from"./Textarea-8732e304.js";import{T as X}from"./Title2-acee3842.js";import{I as Y}from"./Input-1d3b38cd.js";import"./resolveShorthand-d25f9b7a.js";import"./getSlots-be0295ac.js";import"./useFocusWithin-57c2e6c6.js";import"./useTabsterAttributes-06a0aaff.js";import"./useEventCallback-e920580b.js";import"./createFluentIcon-7bef37c8.js";import"./__resetStyles.esm-97b3b7fa.js";import"./useFieldControlProps-edf0dbd1.js";import"./createPreset-7b5d31b4.js";import"./useTextStyles-9f167a2a.js";function Se(){const[e,a]=i.useState([]),t=i.useRef(null),b=i.useRef(null),[D,T]=i.useState(""),[V,y]=i.useState(""),[I,R]=i.useState(""),[C,U]=i.useState(""),[E,B]=i.useState(!1),[w,K]=i.useState(!1),[O,k]=i.useState(!1),[P,M]=i.useState(!1),[z,H]=i.useState(0);g.useEffect(()=>{m(a)},[]);const A=[{columnKey:"Title",label:"标题"},{columnKey:"Description",label:"介绍"},{columnKey:"UploadDate",label:"时间"},{columnKey:"action",label:"操作"}];return s.jsxs("div",{className:"flex flex-col justify-center ",children:[s.jsx(X,{className:"mb-2 ml-2",children:"视频管理"}),s.jsx(_,{videoRef:t,imageRef:b,videoName:D,imageName:V,title:I,description:C,uploading:E,open:w,setOpen:K,setVideoName:T,setImageName:y,setTitle:R,setDescription:U,setUploading:B,setProgress:H,setData:a,setVideoSelected:k,setImageSelected:M,progress:z,imageSelected:P,videoSelected:O}),s.jsx("div",{className:"ml-4 mt-2",children:s.jsxs(Z,{children:[s.jsx(q,{children:s.jsx(u,{children:A.map(l=>s.jsx(F,{children:l.label},l.columnKey))})}),s.jsx(G,{children:e.map((l,L)=>s.jsxs(u,{children:[s.jsx(d,{children:l.Title}),s.jsx(d,{children:l.Description}),s.jsx(d,{children:l.UploadDate}),s.jsx(d,{role:"gridcell",children:ee({item:l,setData:a})})]},L))})]})})]})}function _(e){const a=()=>{if(e.title===""){n.error("请输入视频标题");return}if(e.description===""){n.error("请输入视频简介");return}if(!e.videoSelected){n.error("请选择视频");return}if(!e.imageSelected){n.error("请选择封面");return}e.setUploading(!0),e.videoRef.current.submit(),e.imageRef.current.submit()};return g.useEffect(()=>{e.videoName&&e.imageName&&e.uploading&&r.post("/api/addVideo",{title:e.title,description:e.description,video:e.videoName,cover:e.imageName}).then(t=>{t.data.message==="success"?(n.success("发布成功"),e.setVideoName(""),e.setImageName(""),e.setTitle(""),e.setDescription(""),e.setImageSelected(!1),e.setVideoSelected(!1),e.setOpen(!1),e.setUploading(!1),m(e.setData)):(n.error("发布失败"),e.setUploading(!1))})},[e.videoName,e.imageName]),s.jsxs(f,{open:e.open,onOpenChange:()=>{e.setOpen(!0)},children:[s.jsx(o,{disableButtonEnhancement:!0,children:s.jsx(c,{appearance:"primary",className:"w-0",style:{marginTop:"6px",marginLeft:"8px"},children:"发布视频"})}),s.jsx(x,{children:s.jsxs(h,{children:[s.jsx(j,{action:null,children:"发布视频"}),s.jsx(N,{children:s.jsxs("div",{className:"flex flex-col",children:[s.jsx(Y,{placeholder:"请输入视频标题",value:e.title,onChange:t=>{e.setTitle(t.target.value)}}),s.jsx("div",{className:"mt-2"}),s.jsx(W,{placeholder:"请输入视频简介",value:e.description,onChange:t=>{e.setDescription(t.target.value)}}),s.jsxs("div",{className:"mt-2",children:[s.jsx($,{videoRef:e.videoRef,setVideoName:e.setVideoName,setVideoSelected:e.setVideoSelected,setProgress:e.setProgress}),s.jsx(p,{imageRef:e.imageRef,setImageName:e.setImageName,setImageSelected:e.setImageSelected})]})]})}),s.jsxs(S,{children:[s.jsx(c,{appearance:"secondary",onClick:()=>{e.setOpen(!1),e.setVideoName(""),e.setImageName(""),e.setTitle(""),e.setDescription(""),e.setImageSelected(!1),e.setVideoSelected(!1)},disabled:e.uploading,children:"取消"}),s.jsx(c,{appearance:"primary",onClick:a,disabled:e.uploading,children:e.uploading?s.jsx(J,{size:"small"}):"上传并发布"})]})]})})]})}function $(e){return s.jsxs("div",{className:"flex flex-col w-lg",children:[s.jsx("label",{className:"mb-1",children:"上传视频"}),s.jsx(v,{action:"/api/uploadVideo",ref:e.videoRef,drag:!0,limit:1,autoUpload:!1,accept:"video/*",progressProps:{size:"small",type:"line",showText:!0,width:"100%"},onChange:a=>{try{a[0].status==="done"&&e.setVideoName(a[0].response.file)}catch{}e.setVideoSelected(!0)}})]})}function p(e){return s.jsxs("div",{className:"flex flex-col mt-2",children:[s.jsx("label",{className:"mb-1",children:"上传封面"}),s.jsx(v,{className:"w-18",action:"/api/uploadImage",ref:e.imageRef,listType:"picture-card",limit:1,autoUpload:!1,accept:"image/*",onChange:a=>{try{a[0].status==="done"&&e.setImageName(a[0].response.fileName)}catch{}e.setImageSelected(!0)}})]})}function ee(e){return s.jsxs(f,{children:[s.jsx(o,{disableButtonEnhancement:!0,children:s.jsx(c,{icon:s.jsx(Q,{})})}),s.jsx(x,{children:s.jsxs(h,{children:[s.jsx(j,{children:"删除警告"}),s.jsxs(N,{children:['将要删除标题为 "',e.item.Title,'" 的视频',s.jsx("br",{}),"此操作不可逆，确认删除？"]}),s.jsxs(S,{children:[s.jsx(o,{disableButtonEnhancement:!0,children:s.jsx(c,{appearance:"secondary",children:"取消"})}),s.jsx(o,{children:s.jsx(c,{appearance:"primary",onClick:()=>{se(e.item.Id,e.setData)},children:"确认"})})]})]})})]})}function m(e){r.get("/api/getVideos").then(a=>{a.data.forEach(t=>{t.UploadDate=t.UploadDate.replace("T"," ").replace("Z"," ")}),a.data.reverse(),e(a.data)})}function se(e,a){r.get("/api/deleteVideo?id="+e).then(t=>{console.log(t),m(a)})}export{Se as default};
