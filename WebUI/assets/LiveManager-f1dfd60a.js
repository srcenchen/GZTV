import{R as n,r as R,j as e}from"./index-184e6fdf.js";import{a as g}from"./axios-345d0e8d.js";import{c as k}from"./createFluentIcon-6c3b03c5.js";import{M as d}from"./index-c44e1336.js";import{T as F,a as z,b as E,c as H,d as O,e as m,D as v,f as c,g as P,h as b,i as C,j as D,k as N,l as y,S as V,U as q}from"./index-1cbbd7f5.js";import{T as G}from"./Title2-41ad0ebb.js";import{B as Z}from"./Badge-9d997680.js";import{B as l}from"./useGlobalIcon-6f4b87c8.js";import{I as J}from"./Input-5befa27c.js";import{T as Q}from"./Textarea-34e188b0.js";import"./getSlots-504e8e8d.js";import"./resolveShorthand-d409517b.js";import"./useFocusWithin-4f462636.js";import"./useTabsterAttributes-2cad5257.js";import"./useEventCallback-c6d905c8.js";import"./parseTNode-9250159c.js";import"./createPreset-8bea6d0c.js";import"./useTextStyles-3e4a8e13.js";import"./__resetStyles.esm-715586b5.js";const W=k("AppsListDetail24Filled","24",["M4.25 4C3.01 4 2 5 2 6.25v2.5C2 9.99 3 11 4.25 11h2.5C7.99 11 9 10 9 8.75v-2.5C9 5.01 8 4 6.75 4h-2.5Zm7 1a.75.75 0 0 0 0 1.5h10a.75.75 0 0 0 0-1.5h-10Zm0 3a.75.75 0 0 0 0 1.5h7a.75.75 0 0 0 0-1.5h-7Zm-7 5C3.01 13 2 14 2 15.25v2.5C2 18.99 3 20 4.25 20h2.5C7.99 20 9 19 9 17.75v-2.5C9 14.01 8 13 6.75 13h-2.5Zm7 1a.75.75 0 0 0 0 1.5h10a.75.75 0 0 0 0-1.5h-10Zm0 3a.75.75 0 0 0 0 1.5h7a.75.75 0 0 0 0-1.5h-7Z"]),I=k("Copy24Regular","24",["M5.5 4.63V17.25c0 1.8 1.46 3.25 3.25 3.25h8.62c-.31.88-1.15 1.5-2.13 1.5H8.75A4.75 4.75 0 0 1 4 17.25V6.75c0-.98.63-1.81 1.5-2.12ZM17.75 2C18.99 2 20 3 20 4.25v13c0 1.24-1 2.25-2.25 2.25h-9c-1.24 0-2.25-1-2.25-2.25v-13C6.5 3.01 7.5 2 8.75 2h9Zm0 1.5h-9a.75.75 0 0 0-.75.75v13c0 .41.34.75.75.75h9c.41 0 .75-.34.75-.75v-13a.75.75 0 0 0-.75-.75Z"]);function ge(){const[a,i]=n.useState([]);function t(){const s=n.useRef(null),[o,T]=n.useState(""),[h,S]=n.useState(""),[p,w]=n.useState(""),[x,j]=n.useState(!1),[M,u]=n.useState(!1);let B=!1;const U=()=>{if(h===""){d.error("请输入直播标题");return}if(p===""){d.error("请输入直播简介");return}if(!B){d.error("请选择封面");return}j(!0),s.current.uploadFiles()};R.useEffect(()=>{o&&x&&g.post("/api/addLive",{title:h,description:p,cover:o}).then(r=>{r.data.message==="success"?(d.success("发布成功"),u(!1),j(!1),f(i)):(d.error("发布失败"),j(!1))})},[o]);function A(r){return e.jsxs("div",{className:"flex flex-col ml-8",children:[e.jsx("label",{className:"mb-1",children:"上传封面"}),e.jsx(q,{action:"/api/uploadImage",autoUpload:!1,max:0,method:"POST",multiple:!1,name:"file",accept:"image/*",ref:r.imageRef,onSuccess:L=>{console.log(L.file.response.fileName),T(L.file.response.fileName)},onSelectChange:()=>{B=!0}})]})}return e.jsxs(v,{open:M,onOpenChange:()=>{u(!0)},modalType:"non-modal",children:[e.jsx(c,{disableButtonEnhancement:!0,children:e.jsx(l,{appearance:"primary",className:"w-0",style:{marginTop:"6px",marginLeft:"8px"},children:"发起直播"})}),e.jsx(b,{children:e.jsxs(C,{children:[e.jsx(D,{action:null,children:"发布直播"}),e.jsx(N,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx(J,{placeholder:"请输入直播标题",value:h,onChange:r=>{S(r.target.value)}}),e.jsx("div",{className:"mt-2"}),e.jsx(Q,{placeholder:"请输入直播简介",value:p,onChange:r=>{w(r.target.value)}}),e.jsx("div",{className:"mt-2 flex flex-row justify-center",children:e.jsx(A,{imageRef:s})})]})}),e.jsxs(y,{children:[e.jsx(l,{appearance:"secondary",onClick:()=>{u(!1),T(""),S(""),w("")},disabled:x,children:"取消"}),e.jsx(l,{appearance:"primary",onClick:U,disabled:x,children:x?e.jsx(V,{size:"small"}):"上传并发起"})]})]})})]})}R.useEffect(()=>{f(i)},[]);const K=[{columnKey:"Title",label:"标题"},{columnKey:"Description",label:"简介"},{columnKey:"state",label:"状态"},{columnKey:"date",label:"时间"},{columnKey:"action",label:"操作"}];return e.jsxs("div",{className:"flex flex-col justify-center ",children:[e.jsx(G,{className:"mb-2 ml-2",children:"直播管理"}),e.jsx(t,{}),e.jsx("div",{className:"ml-4 mt-2",children:e.jsxs(F,{children:[e.jsx(z,{children:e.jsx(E,{children:K.map(s=>e.jsx(H,{children:s.label},s.columnKey))})}),e.jsx(O,{children:a.map((s,o)=>e.jsxs(E,{children:[e.jsx(m,{children:s.Title}),e.jsx(m,{children:s.Description}),e.jsx(m,{children:s.LiveState==="true"?e.jsx(Z,{appearance:"filled",color:"success",children:"直播中"}):e.jsx(Z,{appearance:"filled",color:"danger",children:"无信号"})}),e.jsx(m,{children:s.SubmitDate}),e.jsx(m,{role:"gridcell",children:e.jsxs("div",{className:"flex flex-row",children:[e.jsx(Y,{item:s}),e.jsx("div",{className:"ml-2"}),e.jsx(X,{item:s,setData:i})]})})]},o))})]})})]})}function X(a){return e.jsxs(v,{children:[e.jsx(c,{disableButtonEnhancement:!0,children:e.jsx(l,{icon:e.jsx(P,{})})}),e.jsx(b,{children:e.jsxs(C,{children:[e.jsx(D,{children:"删除警告"}),e.jsxs(N,{children:['将要删除标题为 "',a.item.Title,'" 的直播',e.jsx("br",{}),"此操作不可逆，确认删除？"]}),e.jsxs(y,{children:[e.jsx(c,{disableButtonEnhancement:!0,children:e.jsx(l,{appearance:"secondary",children:"取消"})}),e.jsx(c,{children:e.jsx(l,{appearance:"primary",onClick:()=>{_(a.item.Id,a.setData)},children:"确认"})})]})]})})]})}function Y(a){return e.jsxs(v,{children:[e.jsx(c,{disableButtonEnhancement:!0,children:e.jsx(l,{appearance:"primary",icon:e.jsx(W,{})})}),e.jsx(b,{children:e.jsxs(C,{children:[e.jsx(D,{children:"直播详情"}),e.jsx(N,{children:e.jsxs("div",{className:"flex flex-col",children:[e.jsxs("div",{className:"flex flex-row items-center mt-2",children:[e.jsx("div",{className:"w-1/4",children:"推流地址："}),e.jsx("div",{className:"w-3/4",children:"rtmp://"+window.location.hostname+":1936/gztv/"}),e.jsx(l,{appearance:"primary",icon:e.jsx(I,{}),onClick:()=>{navigator.clipboard.writeText("rtmp://"+window.location.hostname+":1936/gztv/")}})]}),e.jsxs("div",{className:"flex flex-row items-center mt-2",children:[e.jsx("div",{className:"w-1/4",children:"推流码："}),e.jsx("div",{className:"w-3/4",children:a.item.StreamName}),e.jsx(l,{appearance:"primary",icon:e.jsx(I,{}),onClick:()=>{navigator.clipboard.writeText(a.item.StreamName)}})]})]})}),e.jsx(y,{children:e.jsx(c,{disableButtonEnhancement:!0,children:e.jsx(l,{appearance:"primary",children:"关闭"})})})]})})]})}function f(a){g.get("/api/getLives").then(i=>{i.data.forEach(t=>{t.SubmitDate=t.SubmitDate.replace("T"," ").replace("Z"," ")}),i.data.reverse(),a(i.data)})}function _(a,i){g.get("/api/deleteLive?id="+a).then(t=>{console.log(t),f(i)})}export{ge as default};
