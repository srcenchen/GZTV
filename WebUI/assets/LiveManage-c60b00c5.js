import{a as h}from"./axios-aba6f0e0.js";import{u as F,a as V,_ as E,c as H}from"./Upload-cc9791c8.js";import{r as l,o as j,b as z,c as D,d as a,w as o,k as N,h as J,a1 as K,e as r,_ as f,f as C,K as O}from"./index-51b823b5.js";import{N as P}from"./headers-94c1b548.js";import{_ as q}from"./Input-1c07be01.js";import{_ as G}from"./text-1ad9e4f8.js";import{_ as Q}from"./Space-fa378203.js";import"./Image-1d56cfa5.js";import"./use-locale-e5897699.js";import"./use-compitable-96053cce.js";import"./Dropdown-b213b067.js";import"./Empty-801f29aa.js";const W={class:"p-8"},X={class:"flex justify-end"},pe={__name:"LiveManage",setup(Y){const k=F(),d=V(),s=l(!1),n=l(!1),c=l(""),x=l(null),v=l(0),L=[{title:"直播标题",dataIndex:"Title",key:"Title"},{title:"推流地址",dataIndex:"AppName",key:"AppName",slots:{customRender:"AppName"}},{title:"推流码",dataIndex:"StreamName",key:"StreamName",slots:{customRender:"StreamName"}},{title:"操作",key:"action",render(t){return J(f,{type:"error",onClick:()=>{const e=k.warning({title:"警告",content:"确定要删除该直播吗？",positiveText:"确定",negativeText:"取消",onPositiveClick:()=>{e.loading=!0,h.get(_+"/api/deleteLive?id="+t.Id).then(u=>{e.loading=!1,u.data.message==="success"?g():k.error({title:"错误",content:"删除失败"})})}})}},{default:()=>"删除"})}}],y=window.location.hostname,_="//"+y+":8020",m=l([]);j(()=>{g()});function g(){h.get(_+"/api/getLives").then(t=>{const e=t.data;e.forEach(u=>{u.AppName="rtmp://"+y+":1936/"+u.AppName+"/"}),m.value=e,m.value=m.value.reverse()})}function b(){var t;if(n.value=!0,c.value===""){d.error("标题不能为空"),n.value=!1;return}if(v.value===0){d.error("封面不能为空"),n.value=!1;return}(t=x.value)==null||t.submit()}function R(t){v.value=t.fileList.length}const i=l("");function T(t){i.value=t.event.currentTarget.response,i.value=JSON.parse(i.value).fileName,A()}function A(){i.value!==""&&h.post(_+"/api/addLive",{title:c.value,cover:i.value}).then(t=>{t.data.message==="success"?(s.value=!1,d.success("发布成功"),g(),s.value=!1,n.value=!1,c.value="",i.value="",v.value=0):(d.error("发布失败"),n.value=!1)})}return(t,e)=>{const u=P,I=q,M=G,S=H,w=Q,U=O,$=K,B=E;return z(),D("div",W,[a(u,null,{default:o(()=>[r("直播管理")]),_:1}),a(N(f),{type:"primary",onClick:e[0]||(e[0]=p=>s.value=!0)},{default:o(()=>[r("发起直播")]),_:1}),a($,{show:s.value,"onUpdate:show":e[3]||(e[3]=p=>s.value=p),"mask-closable":!1},{default:o(()=>[a(U,{style:{width:"480px"},title:"发起直播",bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{footer:o(()=>[C("div",X,[a(w,null,{default:o(()=>[a(N(f),{type:"info",onClick:e[2]||(e[2]=p=>s.value=!1),disabled:n.value},{default:o(()=>[r("取消")]),_:1},8,["disabled"]),a(N(f),{type:"primary",loading:n.value,onClick:b},{default:o(()=>[r("发布")]),_:1},8,["loading"])]),_:1})])]),default:o(()=>[C("div",null,[a(w,{vertical:""},{default:o(()=>[a(I,{value:c.value,"onUpdate:value":e[1]||(e[1]=p=>c.value=p),placeholder:"请输入直播标题","show-count":"",maxlength:30},null,8,["value"]),a(M,null,{default:o(()=>[r("封面图")]),_:1}),a(S,{action:_+"/api/uploadImage","list-type":"image-card",max:1,"default-upload":!1,accept:"image/*",ref_key:"uploadRefCover",ref:x,onChange:R,onFinish:T},{default:o(()=>[r(" 点击上传 ")]),_:1},8,["action"])]),_:1})])]),_:1})]),_:1},8,["show"]),a(B,{columns:L,data:m.value,bordered:!1,class:"mt-4"},null,8,["data"])])}}};export{pe as default};
